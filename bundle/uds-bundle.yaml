kind: UDSBundle
metadata:
  name: renovate-test
  description: A UDS bundle for deploying Renovate and it's dependencies on a development cluster
  # x-release-please-start-version
  version: 38.67.2-uds.0
  # x-release-please-end

packages:
  - name: valkey
    repository: ghcr.io/defenseunicorns/packages/uds/valkey
    ref: 7.2.6-uds.0-upstream
    overrides:
      valkey:
        valkey:
          # using a custom namespace here in the test bundle
          # to deconflict with valkey deployed by gitlab dependency
          namespace: "valkey-renovate"
        uds-valkey-config:
          namespace: "valkey-renovate"
          values:
            - path: custom
              value:
                - direction: Ingress
                  selector:
                    app.kubernetes.io/name: valkey
                  remoteNamespace: renovate
                  port: 6379
                  description: "Ingress from Renovate"
            - path: copyPassword
              value:
                enabled: true
                namespace: renovate
                secretName: valkey-password
                secretKey: password

  - name: renovate
    path: ../
    # x-release-please-start-version
    ref: 38.67.2-uds.0
    # x-release-please-end
    # todo (@ewyles) -- put valkey custom netpol here instead of in the uds-package
    overrides:
      renovate:
        uds-renovate-config:
          values:
            - path: custom
              value:
                - direction: Egress
                  remoteNamespace: valkey-renovate
                  remoteSelector:
                    app.kubernetes.io/name: valkey
                  selector:
                    app.kubernetes.io/name: renovate
                  port: 6379
                  description: "Egress to Valkey"
